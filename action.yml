name: "Pa11y Ratchet"
description: "Fail if Pa11y detects newly-introduced accessibility issues"
inputs:
  sitemap-url:
    description: "The sitemap URL to test"
    required: true
  github-token:
    description: "The GitHub token for the repository"
    required: true
  find:
    description: "The URL substring to search for in sitemap URLs"
    required: false
  replace:
    description: "The replacement string for the find string"
    required: false
  include:
    description: "Only include URLs that match this regular expression"
    required: false
runs:
  using: "composite"
  steps:
    - uses: actions/setup-node@v4
    - uses: pnpm/action-setup@v4
      with:
        version: 9
    - run: pnpm install --prod
      shell: bash
      working-directory: ${{ github.action_path }}
    - uses: actions/github-script@v7
      with:
        github-token: ${{ inputs.github-token }}
        script: await import("${{ github.action_path }}dist/index.js")
      env:
        SITEMAP_URL: ${{ inputs.sitemap-url }}
        GITHUB_TOKEN: ${{ inputs.github-token }}
        FIND: ${{ inputs.find }}
        REPLACE: ${{ inputs.replace }}
        INCLUDE: ${{ inputs.include }}
